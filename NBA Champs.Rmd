---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
library(waffle)
install.packages("hoopR")
# You can install using the pacman package using the following code:
if (!requireNamespace('pacman', quietly = TRUE)){
  install.packages('pacman')
}
library(hoopR)
library(dplyr)
library(tidyverse)
library(cluster)

set.seed(1234)
```
```{r}
tictoc::tic()
progressr::with_progress({
  nba_team_box <- hoopR::load_nba_team_box(2016:2021)
})

tictoc::toc()
```

```{r}
nba_team_box_better <- nba_team_box %>%
  separate(three_point_field_goals_made_three_point_field_goals_attempted, c('three_point_makes', 'three_point_attempts'),"-") %>% 
  mutate(three_point_makes= as.numeric(three_point_makes), three_point_attempts= as.numeric(three_point_attempts ), total_rebounds= as.numeric(total_rebounds), total_turnovers =as.numeric(total_turnovers), points_in_paint= as.numeric(points_in_paint), assists= as.numeric(assists))
  

#Find correlations between a few keys stats to determine which relate the most. Then turn that data into a graph
  
NBA2022 <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
  
```
```{r}
Totals2021 <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
  
```



```{r}
Turnovers <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
  summarise(all_turnovers = sum(total_turnovers))
```
```{r}
PIP <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
  summarise(sum(points_in_paint))
```
```{r}
Assists <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
  summarise(sum(assists))
```
```{r}
ThreePointMakes <- nba_team_box_better %>% 
  filter(season == "2021") %>% 
  group_by (team_name) %>% 
  summarise(sum(three_point_makes))
```


```{r}
TotalScale <- Totals2021 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```
```{r}
k6_2021 <- kmeans(TotalScale, centers = 5, nstart = 10)

```
```{r}
TotalScale %>% 
ggplot() +
  geom_point(aes(x=ThreePointMakes, y=Assists, color="red")) 
```
```{r}
k6_2021
teamcluster <- data.frame(Totals2021, k6_2021$cluster)
```
```{r}
knicks <- teamcluster %>% filter(team_name == "Knicks")

cluster5<- teamcluster %>% filter(k6_2021.cluster == 5)

cluster2<- teamcluster %>% filter(k6_2021.cluster == 2)

```

```{r}
ggplot() +
  geom_point(data=teamcluster, aes(x=ThreePointMakes, y=TotalTurnovers, color=k6_2021.cluster))

```
#2020 Season below
```{r}
NBA2020 <- nba_team_box_better %>% 
  filter(season == "2020") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2020 <- nba_team_box_better %>% 
  filter(season == "2020") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```

```{r}
TotalScale2020 <- Totals2020 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale2020, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```


When I attempt to make another cluster, it overwrites the previous one. How do I fix that?
```{r}
k6_2020 <- kmeans(TotalScale2020, centers = 5, nstart = 10)
```

```{r}
k6_2020
teamcluster <- data.frame(Totals2020, k6_2020$cluster)
```

#2019 season
```{r}
NBA2019 <- nba_team_box_better %>% 
  filter(season == "2019") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2019 <- nba_team_box_better %>% 
  filter(season == "2019") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```


```{r}
NBA2019 <- nba_team_box_better %>% 
  filter(season == "2019") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2019 <- nba_team_box_better %>% 
  filter(season == "2019") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```

```{r}
TotalScale2019 <- Totals2019 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale2019, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```

```{r}
k6_2019 <- kmeans(TotalScale2019, centers = 5, nstart = 10)
```

```{r}
k6_2019
teamcluster <- data.frame(Totals2019, k6_2019$cluster)
```



#2018
```{r}
NBA2018 <- nba_team_box_better %>% 
  filter(season == "2018") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2018 <- nba_team_box_better %>% 
  filter(season == "2018") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```


```{r}
NBA2018 <- nba_team_box_better %>% 
  filter(season == "2018") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2018 <- nba_team_box_better %>% 
  filter(season == "2018") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```

```{r}
TotalScale2018 <- Totals2018 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale2018, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```
```{r}
k6_2018 <- kmeans(TotalScale2018, centers = 5, nstart = 10)
```

```{r}
k6_2018
teamcluster <- data.frame(Totals2018, k6_2018$cluster)
```
#2017
```{r}
NBA2017 <- nba_team_box_better %>% 
  filter(season == "2017") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2017 <- nba_team_box_better %>% 
  filter(season == "2017") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```


```{r}
NBA2017 <- nba_team_box_better %>% 
  filter(season == "2017") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2017 <- nba_team_box_better %>% 
  filter(season == "2017") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```

```{r}
TotalScale2017 <- Totals2017 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale2017, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```


```{r}
k6_2017 <- kmeans(TotalScale2017, centers = 5, nstart = 10)
```

```{r}
k6_2017
teamcluster <- data.frame(Totals2017, k6_2017$cluster)
```
```

#2016

```{r}
NBA2016 <- nba_team_box_better %>% 
  filter(season == "2016") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2016 <- nba_team_box_better %>% 
  filter(season == "2016") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```


```{r}
NBA2016 <- nba_team_box_better %>% 
  filter(season == "2016") %>% 
  group_by (team_name) %>% 
summarize(avg_3pt = sum(three_point_makes)/sum(three_point_attempts)*100) %>% 
  arrange(desc(avg_3pt))
```
```{r}
Totals2016 <- nba_team_box_better %>% 
  filter(season == "2016") %>% 
  group_by (team_name) %>% 
  summarise(TotalRebounds = sum(total_rebounds),TotalTurnovers = sum(total_turnovers),PointsinPaint = sum(points_in_paint), ThreePointMakes = sum(three_point_makes), Assists = sum(assists)) 
```

```{r}
TotalScale2016 <- Totals2016 %>%
  select(PointsinPaint, ThreePointMakes, Assists) %>%
  mutate_all(scale) %>%
  na.omit()
```
```{r}
 # function to compute total within-cluster sum of square
wss <- function(k) {
  kmeans(TotalScale2016, k, nstart = 10 )$tot.withinss
}

# Compute and plot wss for k = 1 to k = 15
k.values <- 1:15

# extract wss for 2-15 clusters
wss_values <- map_dbl(k.values, wss)

plot(k.values, wss_values,
       type="b", pch = 19, frame = FALSE,
       xlab="Number of clusters K",
       ylab="Total within-clusters sum of squares")


```


```{r}
k6_2016 <- kmeans(TotalScale2016, centers = 5, nstart = 10)
```

```{r}
k6_2016
teamcluster <- data.frame(Totals2016, k6_2016$cluster)
```


Conclusions:
Before figuring out cluster:
I chose these specific statistics because I feel that they are key indicators of potential success, especially over an 82 game season. While turnovers are not ideal, they are also a bi-product of high efficiency, quick moving offenses. Therefore, it would be interesting to further determine how this stat factors into crowning an NBA champion. Points in the paint and three point makes are specifically relevant because in the modern NBA, during the regular season, teams are looking for open three or open layups consistently. The best teams are able to live in these areas and therefore become strong indicators of winning. Assists again highlight the strength of a high powered offense, with worse teams tending to generate less assists. Rebounding works in a similar manner, giving insight into potentially the quality of a team's defense or their effectiveness cleaning up their own misses.

After figuring out cluster:
After narrowing down my main statistical determinants to three point makes, points in the paint and assists, the strongest cluster also happened to contain the most elite teams in the NBA during the 2021 season. As I mentioned in my previous analysis, I believe that all good NBA teams are attempting to get a lot of open threes and a lot of layups, both off of assists. This set of clusters supports this analysis thus far. Moving forward, my plan is to do this exact same clustering processs for the four seasons prior to determine whether or not this trend remains true. 




Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

